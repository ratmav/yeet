---
- hosts: void-hw
  tasks:
    - name: update packages
      apt:
        name: "*"
        state: latest
      become: yes

    - name: update development tools
      apt:
        name: build-essential
        state: latest
      become: yes

    - name: get kernel version
      shell: uname -r
      register: kernel

    - name: install kernel headers
      apt:
        name: "linux-headers-{{ kernel.stdout_lines[0] }}"
        state: latest
      become: yes

    - name: copy kernel module
      shell: echo 'TODO - copy kernel module'
      register: copy

    - name: build kernel module
      shell: echo 'TODO - build kernel module'
      register: build

    - name: install kernel module
      shell: echo 'TODO - install kernel module'
      register: install

    - name: reboot
      shell: echo 'TODO - reboot'
      register: reboot

    # remind youself to do the things.
    - debug:
        var: copy.stdout_lines
    - debug:
        var: build.stdout_lines
    - debug:
        var: install.stdout_lines
    - debug:
        var: reboot.stdout_lines
